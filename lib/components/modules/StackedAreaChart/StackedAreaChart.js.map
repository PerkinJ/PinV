{"version":3,"sources":["../../../../src/components/modules/StackedAreaChart/StackedAreaChart.js"],"names":["d3","StackedAreaChart","props","renderData","width","height","padding","stackedAreaChart","select","chartWidth","left","right","chartHeight","top","bottom","parseDate","timeParse","x","scaleTime","range","y","scaleLinear","z","scaleOrdinal","schemeCategory10","stack","area","d","data","date","y0","y1","g","append","attr","tsv","type","error","keys","columns","slice","domain","extent","layer","selectAll","enter","style","key","filter","length","text","call","axisBottom","axisLeft","ticks","setState","stackData","i","n","componentDidMount","render","stackedAreaChartProps","el","map","index","fill","defaultProps"],"mappings":"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","file":"StackedAreaChart.js","sourcesContent":["import { h, Component } from 'preact'\nimport * as d3 from 'd3'\n\n\nclass StackedAreaChart extends Component {\n\tconstructor(props) {\n\t\tsuper(props)\n\t}\n\tstatic defaultProps = {\n\t\twidth:660,\n\t\theight:600,\n\t\tpadding:{ top: 20, right: 20, bottom: 30, left: 50 }\n\t}\n\tcomponentDidMount() {\n\t\tthis.renderData()\n\t}\n\trenderData = () => {\n\t\tconst {width,height,padding} = this.props\n\t\tlet stackedAreaChart = d3.select(this.stackedAreaChart),\n\t\t\tchartWidth = width - padding.left - padding.right,\n\t\t\tchartHeight = height - padding.top - padding.bottom\n\n\t\tlet parseDate = d3.timeParse(\"%Y %b %d\")\n\n\t\tlet x = d3.scaleTime().range([0, chartWidth]),\n\t\t\ty = d3.scaleLinear().range([chartHeight, 0]),\n\t\t\tz = d3.scaleOrdinal(d3.schemeCategory10)\n\n\t\tlet stack = d3.stack()\n\n\t\tlet area = d3.area()\n\t\t\t.x(function (d) { return x(d.data.date) })\n\t\t\t.y0(function (d) { return y(d[0]) })\n\t\t\t.y1(function (d) { return y(d[1]) })\n\n\t\tlet g = stackedAreaChart.append(\"g\")\n\t\t\t.attr(\"transform\", \"translate(\" + padding.left + \",\" + padding.top + \")\")\n\n\t\td3.tsv(\"../../../demo/mock/stackedArea.tsv\", type,  (error, data) =>{\n\t\t\tif (error) throw error\n\n\t\t\tlet keys = data.columns.slice(1)\n\n\t\t\tx.domain(d3.extent(data,(d)=> d.date ))\n\t\t\tz.domain(keys)\n\t\t\tstack.keys(keys)\n\n\n\t\t\tlet layer = g.selectAll(\".layer\")\n\t\t\t\t.data(stack(data))\n\t\t\t\t.enter().append(\"g\")\n\t\t\t\t.attr(\"class\", \"layer\")\n\n\t\t\tlayer.append(\"path\")\n\t\t\t\t.attr(\"class\", \"area\")\n\t\t\t\t.style(\"fill\", function (d) { return z(d.key) })\n\t\t\t\t.attr(\"d\", area)\n\n\t\t\tlayer.filter(function (d) { return d[d.length - 1][1] - d[d.length - 1][0] > 0.01 })\n\t\t\t\t.append(\"text\")\n\t\t\t\t.attr(\"x\", chartWidth - 6)\n\t\t\t\t.attr(\"y\", function (d) { return y((d[d.length - 1][0] + d[d.length - 1][1]) / 2) })\n\t\t\t\t.attr(\"dy\", \".35em\")\n\t\t\t\t.style(\"font\", \"10px sans-serif\")\n\t\t\t\t.style(\"text-anchor\", \"end\")\n\t\t\t\t.text(function (d) { return d.key })\n\n\t\t\tg.append(\"g\")\n\t\t\t\t.attr(\"class\", \"axis axis--x\")\n\t\t\t\t.attr(\"transform\", \"translate(0,\" + chartHeight + \")\")\n\t\t\t\t.call(d3.axisBottom(x))\n\n\t\t\tg.append(\"g\")\n\t\t\t\t.attr(\"class\", \"axis axis--y\")\n\t\t\t\t.call(d3.axisLeft(y).ticks(10, \"%\"))\n\n\t\t\tthis.setState({\n\t\t\t\tdata,\n\t\t\t\tstackData:stack(data)\n\t\t\t})\n\t\t})\n\n\t\tfunction type(d, i, columns) {\n\t\t\td.date = parseDate(d.date)\n\t\t\tfor (let i = 1, n = columns.length; i < n; ++i) d[columns[i]] = d[columns[i]] / 100\n\t\t\treturn d\n\t\t}\n\t}\n\trender({width,height,padding},{stackData}) {\n\t\tconst stackedAreaChartProps = {\n\t\t\twidth,\n\t\t\theight\n\t\t}\n\t\tlet chartWidth = width - padding.left - padding.right,\n\t\t\tchartHeight = height - padding.top - padding.bottom\n\n\t\tlet x = d3.scaleTime().range([0, chartWidth]),\n\t\t\ty = d3.scaleLinear().range([chartHeight, 0]),\n\t\t\tz = d3.scaleOrdinal(d3.schemeCategory10)\n\n\t\tlet area = d3.area()\n\t\t\t.x(d => x(d.data.date) )\n\t\t\t.y0(d => y(d[0]))\n\t\t\t.y1(d => y(d[1]))\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t<svg ref={el=>this.stackedAreaChart = el} {...stackedAreaChartProps}>\n\t\t\t\t\t<g transfrom={`translate(${padding.left},${padding.top}`}>\n\t\t\t\t\t\t{!!stackData&&stackData.map((d,index)=>{\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<g class=\"layer\" key={index}>\n\t\t\t\t\t\t\t\t\t<path class=\"area\" d={area(d)} style={{fill:z(d.key)}}/>\n\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t )})}\n\t\t\t\t\t</g>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default StackedAreaChart\n"]}