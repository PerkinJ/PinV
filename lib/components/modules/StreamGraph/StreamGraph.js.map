{"version":3,"sources":["../../../../src/components/modules/StreamGraph/StreamGraph.js"],"names":["d3","StreamGraph","props","handleMouseOver","e","value","index","setState","activeIdx","tooltip","x","clientX","y","clientY","child","labels","show","handleMouseOut","activeIndex","state","componentDidMount","render","width","height","padding","data","colorRange","interactive","stack","keys","range","length","offset","stackOffsetWiggle","layers","scaleLinear","domain","min","stackMin","max","stackMax","z","scaleOrdinal","interpolateRainbow","area","d","i","y0","y1","layer","el","path","left","top","map","opacity","defaultProps","right","bottom"],"mappings":"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","file":"StreamGraph.js","sourcesContent":["import { h, Component } from 'preact'\nimport * as d3 from 'd3'\nimport styles from './index.css'\nimport Tooltip from '../../common/Tooltip'\nclass StreamGraph extends Component {\n\tconstructor(props) {\n\t\tsuper(props)\n\t\tthis.state={\n\t\t\tactiveIdx:-1,\n\t\t\ttooltip:{}\n\t\t}\n\t}\n\tstatic defaultProps = {\n\t\twidth: 660,\n\t\theight: 600,\n\t\tpadding: { top: 20, right: 20, bottom: 30, left: 50 },\n\t\tcolorRange:[],\n\t\tinteractive:true,\n\t\tlabels : []\n\t}\n\tcomponentDidMount() {\n\n\t}\n\thandleMouseOver = (e,value,index) =>{\n\t\tthis.setState({\n\t\t\tactiveIdx:index,\n\t\t\ttooltip: {\n\t\t\t\tx: e.clientX + 20,\n\t\t\t\ty: e.clientY,\n\t\t\t\tchild: this.props.labels[index],\n\t\t\t\tshow: true\n\t\t\t}\n\t\t})\n\t}\n\thandleMouseOut = ()=>{\n\t\tthis.setState({\n\t\t\tactiveIndex: -1,\n\t\t\ttooltip: {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tchild: '',\n\t\t\t\tshow: false\n\t\t\t}\n\t\t})\n\t}\n\trender({width,height,padding,data,colorRange,interactive,labels},{activeIdx,tooltip}) {\n\t\t// generate stack\n\t\tlet stack = d3.stack().keys(d3.range(data[0].length)).offset(d3.stackOffsetWiggle),\n\t\t\tlayers = stack(data)\n\t\tlet x = d3.scaleLinear()\n\t\t\t.domain([0, layers[0].length-1])\n\t\t\t.range([0, width])\n\n\t\tlet y = d3.scaleLinear()\n\t\t\t.domain([d3.min(layers, stackMin), d3.max(layers, stackMax)])\n\t\t\t.range([height, 0])\n\t\t// color choice\n\t\tlet z = colorRange.length > 0 ?d3.scaleOrdinal().range(colorRange):d3.interpolateRainbow\n\n\t\tlet area = d3.area()\n\t\t\t.x((d, i) => x(i))\n\t\t\t.y0((d) => y(d[0]))\n\t\t\t.y1(d => y(d[1]))\n\n\t\tfunction stackMax(layer) {\n\t\t\treturn d3.max(layer, (d) => d[1])\n\t\t}\n\n\t\tfunction stackMin(layer) {\n\t\t\treturn d3.min(layer, (d) => d[0])\n\t\t}\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t{labels.length > 0&& <Tooltip {...tooltip} />}\n\t\t\t\t<svg width={width} height={height} ref={el => this.StreamGraph = el} >\n\t\t\t\t\t<g class={styles.path} transform={`translate(${padding.left},${padding.top})`}>\n\t\t\t\t\t\t{!!layers&&layers.map((d,index)=>(\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tstyle={{opacity:activeIdx ===index ?1:0.85}}\n\t\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\t\tstroke-width=\"1px\"\n\t\t\t\t\t\t\t\tstroke={activeIdx ===index ?\"#fff\":''}\n\t\t\t\t\t\t\t\td={area(d)}\n\t\t\t\t\t\t\t\tfill={z((index+1)/layers.length)}\n\t\t\t\t\t\t\t\tonMouseOver={interactive ?(e) => this.handleMouseOver(e, layers,index):null}\n\t\t\t\t\t\t\t\tonMouseMove={interactive?(e) => this.handleMouseOver(e, layers,index):null}\n\t\t\t\t\t\t\t\tonMouseOut={interactive?this.handleMouseOut:null}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</g>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default StreamGraph\n"]}