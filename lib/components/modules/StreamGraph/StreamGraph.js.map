{"version":3,"sources":["../../../../src/components/modules/StreamGraph/StreamGraph.js"],"names":["d3","StreamGraph","props","handleMouseOver","e","value","index","setState","activeIdx","content","labels","tooltipStyle","left","clientX","top","clientY","opacity","handleMouseOut","activeIndex","state","componentDidMount","render","width","height","padding","data","colorRange","interactive","stack","keys","range","length","offset","stackOffsetWiggle","layers","x","scaleLinear","domain","y","min","stackMin","max","stackMax","z","scaleOrdinal","interpolateRainbow","area","d","i","y0","y1","layer","el","path","map","defaultProps","right","bottom"],"mappings":"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","file":"StreamGraph.js","sourcesContent":["import { h, Component } from 'preact'\nimport * as d3 from 'd3'\nimport styles from './index.less'\nimport Tooltip from '../../basic/Tooltip'\nclass StreamGraph extends Component {\n\tconstructor(props) {\n\t\tsuper(props)\n\t\tthis.state={\n\t\t\tactiveIdx:-1,\n\t\t\tcontent: '',\n\t\t\ttooltipStyle:{}\n\t\t}\n\t}\n\tstatic defaultProps = {\n\t\twidth: 660,\n\t\theight: 600,\n\t\tpadding: { top: 20, right: 20, bottom: 30, left: 50 },\n\t\tcolorRange:[],\n\t\tinteractive:true,\n\t\tlabels : []\n\t}\n\tcomponentDidMount() {\n\n\t}\n\thandleMouseOver = (e,value,index) =>{\n\t\tthis.setState({\n\t\t\tactiveIdx:index,\n\t\t\tcontent:this.props.labels[index],\n\t\t\ttooltipStyle: {\n\t\t\t\tleft: e.clientX + 20,\n\t\t\t\ttop: e.clientY,\n\t\t\t\topacity: 0.9\n\t\t\t}\n\t\t})\n\t}\n\thandleMouseOut = ()=>{\n\t\tthis.setState({\n\t\t\tactiveIndex: -1,\n\t\t\ttooltipStyle: {\n\t\t\t\topacity: 0\n\t\t\t}\n\t\t})\n\t}\n\trender({width,height,padding,data,colorRange,interactive,labels},{activeIdx,content,tooltipStyle}) {\n\t\t// generate stack\n\t\tlet stack = d3.stack().keys(d3.range(data[0].length)).offset(d3.stackOffsetWiggle),\n\t\t\tlayers = stack(data)\n\t\tlet x = d3.scaleLinear()\n\t\t\t.domain([0, layers[0].length-1])\n\t\t\t.range([0, width])\n\n\t\tlet y = d3.scaleLinear()\n\t\t\t.domain([d3.min(layers, stackMin), d3.max(layers, stackMax)])\n\t\t\t.range([height, 0])\n\t\t// color choice\n\t\tlet z = colorRange.length > 0 ?d3.scaleOrdinal().range(colorRange):d3.interpolateRainbow\n\n\t\tlet area = d3.area()\n\t\t\t.x((d, i) => x(i))\n\t\t\t.y0((d) => y(d[0]))\n\t\t\t.y1(d => y(d[1]))\n\n\t\tfunction stackMax(layer) {\n\t\t\treturn d3.max(layer, (d) => d[1])\n\t\t}\n\n\t\tfunction stackMin(layer) {\n\t\t\treturn d3.min(layer, (d) => d[0])\n\t\t}\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t{labels.length > 0&&<Tooltip\n\t\t\t\t\tcontent={content}\n\t\t\t\t\ttooltipStyle={tooltipStyle}\n\t\t\t\t/>}\n\t\t\t\t<svg width={width} height={height} ref={el => this.StreamGraph = el} >\n\t\t\t\t\t<g class={styles.path} transform={`translate(${padding.left},${padding.top})`}>\n\t\t\t\t\t\t{!!layers&&layers.map((d,index)=>(\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tstyle={{opacity:activeIdx ===index ?1:0.85}}\n\t\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\t\tstroke-width=\"1px\"\n\t\t\t\t\t\t\t\tstroke={activeIdx ===index ?\"#fff\":''}\n\t\t\t\t\t\t\t\td={area(d)}\n\t\t\t\t\t\t\t\tfill={z((index+1)/layers.length)}\n\t\t\t\t\t\t\t\tonMouseOver={interactive ?(e) => this.handleMouseOver(e, layers,index):null}\n\t\t\t\t\t\t\t\tonMouseMove={interactive?(e) => this.handleMouseOver(e, layers,index):null}\n\t\t\t\t\t\t\t\tonMouseOut={interactive?this.handleMouseOut:null}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</g>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default StreamGraph\n"]}