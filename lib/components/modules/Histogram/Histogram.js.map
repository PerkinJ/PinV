{"version":3,"sources":["../../../../src/components/modules/Histogram/Histogram.js"],"names":["d3","Histogram","props","handleMouseOver","e","value","index","XAxis","YAxis","window","event","setState","content","tooltipStyle","left","screenX","top","screenY","opacity","display","activeIdx","handleMouseOut","state","componentDidMount","rectContainer","componentWillUnmount","render","data","padding","width","height","tickSize","tickFormat","stroke","interactive","dWidth","right","length","dHeight","bottom","xDomain","max","d","yDomain","scaleX","scaleLinear","domain","range","scaleY","color","scaleOrdinal","schemeCategory10","container","axis","graph","el","map","rect","key","defaultProps"],"mappings":"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","file":"Histogram.js","sourcesContent":["import { h, Component } from 'preact'\nimport * as d3 from 'd3'\nimport Axis from '../../basic/Axis'\nimport styles from './index.less'\nimport Tooltip from '../../basic/Tooltip'\nimport {addEvent,removeEvent} from '../../../utils/utils'\nclass Histogram extends Component {\n\tstatic defaultProps = {\n\t\twidth: 600,\n\t\theight: 400,\n\t\tpadding: { top: 32, bottom: 32, left: 20, right: 20 },\n\t\t// left: 40,\n\t\ttickSize: 5,\n\t\ttickFormat: '',\n\t\tstroke: '#673ab7',\n\t\tinteractive: true\n\t}\n\tconstructor(props) {\n\t\tsuper(props)\n\t\tthis.state = {\n\t\t\tcontent: 'test',\n\t\t\ttooltipStyle: { left: 0, top: 0 },\n\t\t\tactiveIdx:null\n\t\t}\n\t}\n\thandleMouseOver = (e,value,index) => {\n\t\tconst { XAxis, YAxis } = this.props\n\t\te = e || window.event\n\t\tthis.setState({\n\t\t\tcontent: `${XAxis}  ${value[XAxis]} : ${YAxis}  ${value[YAxis]}`,\n\t\t\ttooltipStyle: {\n\t\t\t\tleft: e.screenX + 10,\n\t\t\t\ttop: e.screenY - 140,\n\t\t\t\topacity: 0.9,\n\t\t\t\tdisplay:'block'\n\t\t\t},\n\t\t\tactiveIdx:index\n\t\t})\n\t}\n\thandleMouseOut = () => {\n\t\tthis.setState({\n\t\t\ttooltipStyle: {\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\tactiveIdx:'0'\n\t\t})\n\t}\n\tcomponentDidMount(){\n\t\taddEvent(this.rectContainer,'mouseleave',this.handleMouseOut)\n\t}\n\tcomponentWillUnmount(){\n\t\tremoveEvent(this.rectContainer,'mouseleave',this.handleMouseOut)\n\t}\n\trender({ data, padding, width, height, XAxis, YAxis, tickSize, tickFormat, stroke, interactive }, { content, tooltipStyle,activeIdx }) {\n\t\tlet dWidth = width - padding.left - padding.right - data.length / 2,\n\t\t\tdHeight = height - padding.top - padding.bottom\n\t\tlet xDomain = d3.max(data, (d) => d[XAxis]),\n\t\t\tyDomain = d3.max(data, (d) => d[YAxis])\n\t\tlet scaleX = d3.scaleLinear()\n\t\t\t.domain([0, xDomain])\n\t\t\t.range([0, dWidth])\n\t\tlet scaleY = d3.scaleLinear()\n\t\t\t.domain([0, yDomain])\n\t\t\t.range([dHeight, padding.bottom])\n\t\tlet color = d3.scaleOrdinal(d3.schemeCategory10)\n\n\t\treturn <div class={styles.container}>\n\t\t\t<Tooltip\n\t\t\t\tcontent={content}\n\t\t\t\ttooltipStyle={tooltipStyle}\n\t\t\t/>\n\t\t\t<svg width={width + padding.left + padding.right} height={height + padding.top + padding.bottom}>\n\t\t\t\t<Axis\n\t\t\t\t\ttype=\"x\"\n\t\t\t\t\tdataKey={XAxis}\n\t\t\t\t\tdata={data}\n\t\t\t\t\tlength={dWidth}\n\t\t\t\t\tstroke={stroke}\n\t\t\t\t\torient=\"bottom\"\n\t\t\t\t\tclass={styles.axis}\n\t\t\t\t\ttextAnchor=\"middle\"\n\t\t\t\t\ttransform={`translate(${padding.left},${dHeight + padding.top})`} />\n\t\t\t\t<Axis\n\t\t\t\t\ttype='y'\n\t\t\t\t\tdataKey={YAxis}\n\t\t\t\t\tlength={dHeight}\n\t\t\t\t\tdata={data}\n\t\t\t\t\tstroke={stroke}\n\t\t\t\t\torient=\"left\"\n\t\t\t\t\tclass={styles.axis}\n\t\t\t\t\ttickSize={tickSize}\n\t\t\t\t\ttickFormat={tickFormat}\n\t\t\t\t\ttextAnchor=\"end\"\n\t\t\t\t\ttransform={`translate(${padding.left} ,${padding.top})`} />\n\t\t\t\t<g class={styles.graph} ref={el => this.rectContainer = el} >\n\t\t\t\t\t{data.map((d, index) => {\n\t\t\t\t\t\tlet width = dWidth / data.length\n\t\t\t\t\t\t// \t这里为了交互效果，增加了一个蒙层rect\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<g>\n\t\t\t\t\t\t\t\t<rect\n\t\t\t\t\t\t\t\t\tkey={index + 1}\n\t\t\t\t\t\t\t\t\tref={el => this.rect = el}\n\t\t\t\t\t\t\t\t\tclass={styles.rect}\n\t\t\t\t\t\t\t\t\twidth={width}\n\t\t\t\t\t\t\t\t\theight={dHeight - scaleY(d.value)}\n\t\t\t\t\t\t\t\t\ttransform={`translate(${scaleX(d.key) + padding.left},${scaleY(d.value) + padding.top})`}\n\t\t\t\t\t\t\t\t\tfill={color(d.value)} />\n\t\t\t\t\t\t\t\t<rect\n\t\t\t\t\t\t\t\t\tkey={index + 1}\t\t//这里主要为了让activeIdx有一个默认的0为初始值\n\t\t\t\t\t\t\t\t\tonMouseOver={interactive?(e) => this.handleMouseOver(e,d,index):null}\n\t\t\t\t\t\t\t\t\tonMouseMove={interactive?(e) => this.handleMouseOver(e,d,index):null}\n\t\t\t\t\t\t\t\t\twidth={width+2}\n\t\t\t\t\t\t\t\t\theight={dHeight}\n\t\t\t\t\t\t\t\t\tfill=\"#000\"\n\t\t\t\t\t\t\t\t\tstyle={{opacity:activeIdx === index?'0.15':'0'}}\n\t\t\t\t\t\t\t\t\ttransform={`translate(${scaleX(d.key) + padding.left -1},${padding.top})`} />\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t)\n\t\t\t\t\t})}\n\n\t\t\t\t</g>\n\t\t\t</svg>\n\t\t</div>\n\t}\n}\nexport default Histogram\n"]}