{"version":3,"sources":["../../../../src/components/modules/Histogram/Histogram.js"],"names":["d3","Histogram","props","handleMouseOver","e","value","index","XAxis","YAxis","window","event","setState","tooltip","x","screenX","y","screenY","child","show","activeIdx","handleMouseOut","state","content","tooltipStyle","left","top","componentDidMount","rectContainer","componentWillUnmount","render","data","padding","width","height","tickSize","tickFormat","stroke","interactive","dWidth","right","length","dHeight","bottom","xDomain","max","d","yDomain","scaleX","scaleLinear","domain","range","scaleY","color","scaleOrdinal","schemeCategory10","el","map","rect","key","opacity","defaultProps"],"mappings":"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","file":"Histogram.js","sourcesContent":["import { h, Component } from 'preact'\nimport * as d3 from 'd3'\nimport Axis from '../../basic/Axis'\nimport Tooltip from '../../common/Tooltip'\nimport {addEvent,removeEvent} from '../../../utils/utils'\nclass Histogram extends Component {\n\tstatic defaultProps = {\n\t\twidth: 600,\n\t\theight: 400,\n\t\tpadding: { top: 32, bottom: 32, left: 20, right: 20 },\n\t\t// left: 40,\n\t\ttickSize: 5,\n\t\ttickFormat: '',\n\t\tstroke: '#673ab7',\n\t\tinteractive: true\n\t}\n\tconstructor(props) {\n\t\tsuper(props)\n\t\tthis.state = {\n\t\t\tcontent: 'test',\n\t\t\ttooltipStyle: { left: 0, top: 0 },\n\t\t\tactiveIdx:null\n\t\t}\n\t}\n\thandleMouseOver = (e,value,index) => {\n\t\tconst { XAxis, YAxis } = this.props\n\t\te = e || window.event\n\t\tthis.setState({\n\t\t\ttooltip: {\n\t\t\t\tx: e.screenX + 10,\n\t\t\t\ty: e.screenY - 140,\n\t\t\t\tchild:`${XAxis}  ${value[XAxis]} : ${YAxis}  ${value[YAxis]}`,\n\t\t\t\tshow:true\n\t\t\t},\n\t\t\tactiveIdx:index\n\t\t})\n\t}\n\thandleMouseOut = () => {\n\t\tthis.setState({\n\t\t\ttooltip: {\n\t\t\t\tx: 0,\n\t\t\t\ty:0,\n\t\t\t\tchild:'',\n\t\t\t\tshow:false\n\t\t\t},\n\t\t\tactiveIdx:'0'\n\t\t})\n\t}\n\tcomponentDidMount(){\n\t\taddEvent(this.rectContainer,'mouseleave',this.handleMouseOut)\n\t}\n\tcomponentWillUnmount(){\n\t\tremoveEvent(this.rectContainer,'mouseleave',this.handleMouseOut)\n\t}\n\trender({ data, padding, width, height, XAxis, YAxis, tickSize, tickFormat, stroke, interactive }, { tooltip,activeIdx }) {\n\t\tlet dWidth = width - padding.left - padding.right - data.length / 2,\n\t\t\tdHeight = height - padding.top - padding.bottom\n\t\tlet xDomain = d3.max(data, (d) => d[XAxis]),\n\t\t\tyDomain = d3.max(data, (d) => d[YAxis])\n\t\tlet scaleX = d3.scaleLinear()\n\t\t\t.domain([0, xDomain])\n\t\t\t.range([0, dWidth])\n\t\tlet scaleY = d3.scaleLinear()\n\t\t\t.domain([0, yDomain])\n\t\t\t.range([dHeight, padding.bottom])\n\t\tlet color = d3.scaleOrdinal(d3.schemeCategory10)\n\n\t\treturn <div>\n\t\t\t<Tooltip\n\t\t\t\t{...tooltip}\n\t\t\t/>\n\t\t\t<svg width={width + padding.left + padding.right} height={height + padding.top + padding.bottom}>\n\t\t\t\t<Axis\n\t\t\t\t\ttype=\"x\"\n\t\t\t\t\tdataKey={XAxis}\n\t\t\t\t\tdata={data}\n\t\t\t\t\tlength={dWidth}\n\t\t\t\t\tstroke={stroke}\n\t\t\t\t\torient=\"bottom\"\n\t\t\t\t\ttextAnchor=\"middle\"\n\t\t\t\t\ttransform={`translate(${padding.left},${dHeight + padding.top})`} />\n\t\t\t\t<Axis\n\t\t\t\t\ttype='y'\n\t\t\t\t\tdataKey={YAxis}\n\t\t\t\t\tlength={dHeight}\n\t\t\t\t\tdata={data}\n\t\t\t\t\tstroke={stroke}\n\t\t\t\t\torient=\"left\"\n\t\t\t\t\ttickSize={tickSize}\n\t\t\t\t\ttickFormat={tickFormat}\n\t\t\t\t\ttextAnchor=\"end\"\n\t\t\t\t\ttransform={`translate(${padding.left} ,${padding.top})`} />\n\t\t\t\t<g  ref={el => this.rectContainer = el} >\n\t\t\t\t\t{data.map((d, index) => {\n\t\t\t\t\t\tlet width = dWidth / data.length\n\t\t\t\t\t\t// \t这里为了交互效果，增加了一个蒙层rect\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<g>\n\t\t\t\t\t\t\t\t<rect\n\t\t\t\t\t\t\t\t\tkey={index + 1}\n\t\t\t\t\t\t\t\t\tref={el => this.rect = el}\n\t\t\t\t\t\t\t\t\twidth={width}\n\t\t\t\t\t\t\t\t\theight={dHeight - scaleY(d.value)}\n\t\t\t\t\t\t\t\t\ttransform={`translate(${scaleX(d.key) + padding.left},${scaleY(d.value) + padding.top})`}\n\t\t\t\t\t\t\t\t\tfill={color(d.value)} />\n\t\t\t\t\t\t\t\t<rect\n\t\t\t\t\t\t\t\t\tkey={index + 1}\t\t//这里主要为了让activeIdx有一个默认的0为初始值\n\t\t\t\t\t\t\t\t\tonMouseOver={interactive?(e) => this.handleMouseOver(e,d,index):null}\n\t\t\t\t\t\t\t\t\tonMouseMove={interactive?(e) => this.handleMouseOver(e,d,index):null}\n\t\t\t\t\t\t\t\t\twidth={width+2}\n\t\t\t\t\t\t\t\t\theight={dHeight}\n\t\t\t\t\t\t\t\t\tfill=\"#000\"\n\t\t\t\t\t\t\t\t\tstyle={{opacity:activeIdx === index?'0.15':'0'}}\n\t\t\t\t\t\t\t\t\ttransform={`translate(${scaleX(d.key) + padding.left -1},${padding.top})`} />\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t)\n\t\t\t\t\t})}\n\n\t\t\t\t</g>\n\t\t\t</svg>\n\t\t</div>\n\t}\n}\nexport default Histogram\n"]}