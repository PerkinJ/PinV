{"version":3,"sources":["../../../../src/components/modules/ForceDirectedGraph/ForceDirectedGraph.js"],"names":["d3","ForceDirecteddata","props","renderData","color","scaleOrdinal","schemeCategory20","data","width","height","interactive","velocityDecay","strength","collide","distance","simulation","forceSimulation","force","forceLink","id","d","forceManyBody","forceCenter","forceCollide","svg","select","forceDirected","link","append","attr","selectAll","links","enter","Math","sqrt","value","node","nodes","group","call","drag","on","dragstarted","dragged","dragended","handleMouseOver","handleMouseOut","ticked","source","x","y","target","event","active","alphaTarget","restart","fx","fy","tooltip","contentArr","length","forEach","str","push","tool","content","join","html","style","pageX","clientY","handleMouseMove","state","componentWillUnmount","componentDidMount","render","container","el","defaultProps"],"mappings":"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","file":"ForceDirectedGraph.js","sourcesContent":["import { h, Component } from 'preact'\nimport * as d3 from 'd3'\nimport styles from './index.less'\n\nclass ForceDirecteddata extends Component {\n\tstatic defaultProps = {\n\t\twidth: 1000,\n\t\theight: 500,\n\t\tinteractive: true,\n\t\ttooltip: [],\n\t\tvelocityDecay:0.5,\n\t\tstrength:-50,\n\t\tcollide:12.5,\n\t\tdistance:20\n\t}\n\tconstructor(props) {\n\t\tsuper(props)\n\t\tthis.state = {\n\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\t// removeEvent(this.nodesContainer, 'mouseleave', this.handleMouseOut)\n\t}\n\tcomponentDidMount() {\n\t\tthis.renderData()\n\t\t// addEvent(this.nodesContainer, 'mouseleave', this.handleMouseOut)\n\t}\n\trenderData = () => {\n\t\tlet color = d3.scaleOrdinal(d3.schemeCategory20)\n\n\t\tconst { data, width, height, interactive,velocityDecay,strength,collide,distance } = this.props\n\n\t\tlet simulation = d3.forceSimulation()\n\t\t\t.velocityDecay(velocityDecay)\n\t\t\t.force(\"link\", d3.forceLink().id(d => d.id))\n\t\t\t.force(\"charge\", d3.forceManyBody().strength(strength))\n\t\t\t.force(\"center\", d3.forceCenter(width / 2, height / 2))\n\t\t\t.force('collide',d3.forceCollide(collide))\n\n\t\tlet svg = d3.select(this.forceDirected)\n\t\tlet link = svg.append(\"g\")\n\t\t\t.attr(\"class\", \"links\")\n\t\t\t.selectAll(\"line\")\n\t\t\t.data(data.links)\n\t\t\t.enter().append(\"line\")\n\t\t\t.attr(\"stroke-width\", (d) => Math.sqrt(d.value))\n\t\t\t.attr('stroke', '#999')\n\t\t\t.attr('stroke-opacity', 0.6)\n\n\t\tlet node = svg.append(\"g\")\n\t\t\t.attr(\"class\", \"nodes\")\n\t\t\t.selectAll(\"circle\")\n\t\t\t.data(data.nodes)\n\t\t\t.enter().append(\"circle\")\n\t\t\t.attr(\"r\", 5)\n\t\t\t.attr(\"fill\", (d) => color(d.group))\n\t\t\t.attr('stroke','#fff')\n\t\t\t.attr('stroke-width','1.5')\n\t\t\t.call(d3.drag()\n\t\t\t\t.on(\"start\", dragstarted)\n\t\t\t\t.on(\"drag\", dragged)\n\t\t\t\t.on(\"end\", dragended))\n\t\t\t.on('mouseover', interactive?(d) => this.handleMouseOver(d):null)\n\t\t\t.on('mouseout', interactive?this.handleMouseOut:null)\n\t\t\t.on('mousemove', interactive?(d) => this.handleMouseOver(d):null)\n\n\t\tsimulation\n\t\t\t.nodes(data.nodes)\n\t\t\t.on(\"tick\", ticked)\n\n\t\tsimulation.force(\"link\")\n\t\t\t.links(data.links)\n\t\t\t.distance(distance)\n\n\t\tfunction ticked() {\n\t\t\tlink\n\t\t\t\t.attr(\"x1\", (d) => d.source.x)\n\t\t\t\t.attr(\"y1\", (d) => d.source.y)\n\t\t\t\t.attr(\"x2\", (d) => d.target.x)\n\t\t\t\t.attr(\"y2\", (d) => d.target.y)\n\n\t\t\tnode\n\t\t\t\t.attr(\"cx\", (d) => d.x)\n\t\t\t\t.attr(\"cy\", (d) => d.y)\n\t\t}\n\n\t\tfunction dragstarted(d) {\n\t\t\tif (!d3.event.active) simulation.alphaTarget(0.3).restart()\n\t\t\td.fx = d.x\n\t\t\td.fy = d.y\n\t\t}\n\n\t\tfunction dragged(d) {\n\t\t\td.fx = d3.event.x\n\t\t\td.fy = d3.event.y\n\t\t}\n\n\t\tfunction dragended(d) {\n\t\t\tif (!d3.event.active) simulation.alphaTarget(0)\n\t\t\td.fx = null\n\t\t\td.fy = null\n\t\t}\n\t}\n\thandleMouseOver = (value) => {\n\t\tconst { tooltip } = this.props\n\t\tlet contentArr = []\n\t\tif (tooltip && tooltip.length > 0) {\n\t\t\ttooltip.forEach(d => {\n\t\t\t\tlet str = d + ':' + value[d]\n\t\t\t\tcontentArr.push(str)\n\t\t\t})\n\t\t}\n\t\tlet tool = d3.select(this.tooltip)\n\t\tlet content = contentArr.join(',')\n\t\ttool.html(content)\n\t\t\t.style('left', `${d3.event.pageX + 10}px`)\n\t\t\t.style('top', `${d3.event.clientY}px`)\n\t\t\t.style('opacity', 1)\n\t}\n\thandleMouseMove = () => {\n\t\tlet tool = d3.select(this.tooltip)\n\t\ttool.html('')\n\t\t\t.style('left', `${d3.event.pageX + 10}px`)\n\t\t\t.style('top', `${d3.event.clientY}px`)\n\t}\n\thandleMouseOut = () => {\n\t\tlet tool = d3.select(this.tooltip)\n\t\ttool.html('').style('opacity', 0)\n\t}\n\trender({ width, height }, { }) {\n\t\treturn (\n\t\t\t<div class={styles.container}>\n\t\t\t\t<div class={styles.tooltip} ref={el => this.tooltip = el} />\n\t\t\t\t<svg ref={el => this.forceDirected = el} width={width} height={height} />\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default ForceDirecteddata\n"]}