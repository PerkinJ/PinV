{"version":3,"sources":["../../../../src/components/webgl/ForceDirectedGraphGL/ForceDirectedGraphGL.js"],"names":["d3","THREE","ForceGLLayout","componentDidMount","props","data","width","height","scene","Scene","camera","OrthographicCamera","renderer","WebGLRenderer","antialias","precision","alpha","container","glGontainer","setSize","setPixelRatio","window","devicePixelRatio","appendChild","domElement","position","z","nodes","forEach","node","geometry","CircleBufferGeometry","material","MeshBasicMaterial","color","id","circle","Mesh","add","links","link","LineBasicMaterial","Geometry","line","Line","simulationGl","forceSimulation","force","forceLink","d","forceManyBody","forceCenter","on","ticked","select","call","drag","subject","getClosestNode","dragstarted","dragged","dragended","find","event","x","y","_this","active","alphaTarget","restart","fx","fy","setState","tooltip","child","show","set","source","target","verticesNeedUpdate","vertices","Vector3","render","el"],"mappings":"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","file":"ForceDirectedGraphGL.js","sourcesContent":["\nimport * as d3 from 'd3'\nimport * as THREE from 'three'\nimport { h, Component } from 'preact'\nimport { colour } from '../../../utils/utils'\nimport Tooltip from '../../common/Tooltip'\nclass ForceGLLayout extends Component {\n\tcomponentDidMount() {\n\t\tconst { data, width, height } = this.props\n\n\t\tconst scene = new THREE.Scene()\n\t\tconst camera = new THREE.OrthographicCamera(0, width, height, 0, 1, 1000)\n\t\tconst renderer = new THREE.WebGLRenderer({\n\t\t\tantialias: true,\n\t\t\tprecision: 'highp',\n\t\t\talpha: true\n\t\t})\n\t\tlet container = this.glGontainer\n\t\trenderer.setSize(width, height)\n\t\trenderer.setPixelRatio(window.devicePixelRatio)\n\t\tcontainer.appendChild(renderer.domElement)\n\t\tcamera.position.z = 5\n\n\t\tdata.nodes.forEach((node) => {\n\t\t\tnode.geometry = new THREE.CircleBufferGeometry(5, 32)\n\t\t\tnode.material = new THREE.MeshBasicMaterial({ color: colour(node.id) })\n\t\t\tnode.circle = new THREE.Mesh(node.geometry, node.material)\n\t\t\tscene.add(node.circle)\n\t\t})\n\n\t\tdata.links.forEach((link) => {\n\t\t\tlink.material = new THREE.LineBasicMaterial({ color: 0xAAAAAA })\n\t\t\tlink.geometry = new THREE.Geometry()\n\t\t\tlink.line = new THREE.Line(link.geometry, link.material)\n\t\t\tscene.add(link.line)\n\t\t})\n\n\t\tconst simulationGl = d3.forceSimulation()\n\t\t\t.force('link', d3.forceLink().id((d) => d.id))\n\t\t\t.force('charge', d3.forceManyBody())\n\t\t\t.force('center', d3.forceCenter(width / 2, height / 2))\n\n\t\tsimulationGl\n\t\t\t.nodes(data.nodes)\n\t\t\t.on('tick', ticked)\n\n\t\tsimulationGl.force('link')\n\t\t\t.links(data.links)\n\n\t\td3.select(this.glGontainer)\n\t\t\t.call(d3.drag().container(this.glGontainer)\n\t\t\t\t.subject(getClosestNode)\n\t\t\t\t.on('start', dragstarted)\n\t\t\t\t.on('drag',dragged)\n\t\t\t\t.on('end',dragended))\n\n\n\t\tfunction getClosestNode() {\n\t\t\treturn simulationGl.find(d3.event.x, d3.event.y)\n\t\t}\n\t\tconst _this = this\n\n\t\tfunction dragstarted() {\n\t\t\tif (!d3.event.active) simulationGl.alphaTarget(0.3).restart()\n\t\t\td3.event.subject.fx = d3.event.subject.x\n\t\t\td3.event.subject.fy = d3.event.subject.y\n\t\t\t_this.setState({\n\t\t\t\ttooltip:{\n\t\t\t\t\tx:d3.event.subject.x,\n\t\t\t\t\ty:d3.event.subject.y,\n\t\t\t\t\tchild:'test',\n\t\t\t\t\tshow:true\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\tfunction dragged(){\n\t\t\td3.event.subject.fx = d3.event.x\n\t\t\td3.event.subject.fy = d3.event.y\n\t\t}\n\t\tfunction dragended(){\n\t\t\tif (!d3.event.active)simulationGl.alphaTarget(0)\n\t\t\td3.event.subject.fx = null\n\t\t\td3.event.subject.fy = null\n\t\t}\n\n\t\tfunction ticked() {\n\t\t\tdata.nodes.forEach((node) => {\n\t\t\t\tconst { x, y, circle } = node\n\t\t\t\tcircle.position.set(x, y, 0)\n\t\t\t})\n\n\t\t\tdata.links.forEach((link) => {\n\t\t\t\tconst { source, target, line } = link\n\t\t\t\tline.geometry.verticesNeedUpdate = true\n\t\t\t\tline.geometry.vertices[0] = new THREE.Vector3(source.x, source.y, -1)\n\t\t\t\tline.geometry.vertices[1] = new THREE.Vector3(target.x, target.y, -1)\n\t\t\t})\n\n\t\t\trenderer.render(scene, camera)\n\t\t}\n\t}\n\trender({ }, { tooltip }) {\n\t\treturn (\n\t\t\t<div ref={el => this.glGontainer = el} >\n\t\t\t\t<Tooltip {...tooltip} />\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default ForceGLLayout\n"]}